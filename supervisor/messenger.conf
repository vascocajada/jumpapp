[program:messenger-consume]
command=php /var/www/html/bin/console messenger:consume async --time-limit=3600 --memory-limit=512M --limit=1000
user=www-data
numprocs=2
autostart=true
autorestart=true
startretries=3
startsecs=10
process_name=%(program_name)s_%(process_num)02d
stdout_logfile=/var/log/supervisor/messenger-consume.log
stderr_logfile=/var/log/supervisor/messenger-consume-error.log
redirect_stderr=true
environment=PATH="/usr/local/bin:/usr/bin:/bin"

# Restart on exit
exitcodes=0,2
stopsignal=TERM
stopwaitsecs=10

# Health check
[eventlistener:messenger-health]
command=php /var/www/html/bin/console messenger:health-check
events=TICK_60
autostart=true
autorestart=true 